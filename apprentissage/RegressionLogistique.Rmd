---
title: "Régression Logistique"
author: "Votre Nom"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Chargement des librairies
```{r libraries}
library(tidyverse)
library(caret)
library(pROC)
library(ggplot2)
library(ROCR)
library(e1071)
```

## Chargement et préparation des données
```{r data-preparation}
# Charger les données d'entraînement
train_data <- read.csv("data/farms_train.csv", sep = ";", dec = ",")

# Aperçu des données
cat("Aperçu des données d'entraînement :\n")
print(head(train_data))

# Vérification des valeurs manquantes
cat("\nValeurs manquantes avant suppression :\n")
print(colSums(is.na(train_data)))

# Suppression des valeurs manquantes
train_data <- na.omit(train_data)
cat("\nValeurs manquantes après suppression :\n")
print(colSums(is.na(train_data)))

# Séparer les variables explicatives et la cible
X <- train_data %>% select(-DIFF)
y <- as.factor(train_data$DIFF)

# Diviser les données en ensembles d'entraînement et de validation
set.seed(42)
train_index <- createDataPartition(y, p = 0.8, list = FALSE)
X_train <- X[train_index, ]
X_val <- X[-train_index, ]
y_train <- y[train_index]
y_val <- y[-train_index]

# Normalisation des données
scaler <- preProcess(X_train, method = c("center", "scale"))
X_train <- predict(scaler, X_train)
X_val <- predict(scaler, X_val)
```

## Régression logistique
```{r logistic-regression}
# Entraîner le modèle de régression logistique
log_reg <- train(
  X_train, y_train,
  method = "glm",
  family = binomial(link = "logit")
)

# Prédictions sur l'ensemble de validation
y_pred <- predict(log_reg, X_val)
```

## Évaluation du modèle
```{r evaluation}
# Matrice de confusion
conf_matrix <- confusionMatrix(y_pred, y_val)
cat("\nMatrice de confusion :\n")
print(conf_matrix)

# Rapport de classification
cat("\nRapport de classification :\n")
print(conf_matrix$byClass)

# Score d'accuracy
accuracy <- conf_matrix$overall["Accuracy"]
cat(sprintf("\nScore d'accuracy : %.2f\n", accuracy))

# AUC et courbe ROC
probabilities <- predict(log_reg, X_val, type = "prob")
y_pred_prob <- probabilities[, 2]
roc_curve <- roc(y_val, y_pred_prob)
auc_value <- auc(roc_curve)
cat(sprintf("\nAUC (Régression Logistique) : %.2f\n", auc_value))

# Tracer la courbe ROC
plot(roc_curve, col = "blue", main = "Courbe ROC - Régression Logistique")
abline(a = 0, b = 1, lty = 2, col = "red")
```

## Prédictions sur les données de test
```{r test-predictions}
# Charger les données de test
farm_test <- read.csv("data/farms_test.csv", sep = ";", dec = ",")

# Vérification des valeurs manquantes
cat("\nValeurs manquantes dans les données de test :\n")
print(colSums(is.na(farm_test)))

# Normaliser les données de test avec le même scaler
farm_test_scaled <- predict(scaler, farm_test)
farm_test_predictions <- predict(log_reg, farm_test_scaled)

# Ajouter les prédictions aux données de test
farm_test$DIFF_Predicted <- farm_test_predictions
write.csv(farm_test[, c("DIFF_Predicted")], "resultats_test.csv", row.names = FALSE)
cat("\nLes prédictions sont dans le fichier 'resultats_test.csv'.\n")
